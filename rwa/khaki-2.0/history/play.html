<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Player</title>
<style>
  body {
         margin: 0px
       }
       .jwplayer {
            position: absolute !important
         }
       .jwplayer.jw-flag-aspect-mode {
            min-height: 100%;
           max-height: 100%
         }
         #settingsButton {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      color: white;
      border: none;
      cursor: pointer;
    }

    #popupMenu {
      display: none;
      position: absolute;
      top: 30px;
      right: 10px;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
    }
</style>
</head>

<body>
	
  <div id="popupMenu"></div>
  
<script disable-devtool-auto='true' src=
  'https://cdn.jsdelivr.net/npm/disable-devtool' clear-log='true'
  disable-select='true' disable-copy='true' disable-cut='true'
  disable-paste='true'></script>

<script src="/js/jw.js"></script>
<script> jwplayer.defaults = jwDefaults; </script>  
<div id="jwplayerDiv"></div>  
<script>
// Function to get URL parameters
function getParameterByName(name, url) {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}

// Function to fetch JSON data
function fetchChannels(callback) {
  // Replace 'path/to/your/channels.json' Remember add the json in url format 
  fetch('/rwa/khaki-2.0/history/index.json')
    .then(response => response.json())
    .then(data => callback(data))
    .catch(error => console.error('Error fetching JSON:', error));
}

// Define player setup function
function setupPlayer(channelData) {
  // Set up JWPlayer
  var playerSetup = {
    file: channelData.link, // Using link as file URL
    // Add your Extra jw Player codes here 
 "image": "/assets/img/play-cover.jpg",
 "autostart": true,
 "preload": "none",
  "repeat": true,
  "Volume": "100",
  "mute": false,
  "stretching": "exactfit",
  "width": "100%", 
  "cast": {},
  };

  if (channelData.link.endsWith('.mpd')) {
    // Set up DRM for DASH with KeyId & key if available
    playerSetup.type = 'dash';

    // Check if Clear Key is available
    if (channelData.keyId && channelData.key) {
      playerSetup.drm = {
        clearkey: {
          keyId: channelData.keyId,
          key: channelData.key
        }
      };
    }
  } else if (channelData.link.endsWith('.m3u8')) {
    // Set up DRM for HLS with keys if available
    playerSetup.type = 'hls';

    // Check if Clear Key is available
    if (channelData.keyId && channelData.key) {
      playerSetup.drm = {
        clearkey: {
          keyId: channelData.keyId,
          key: channelData.key
        }
      };
    }
  } else {
    // Default to HLS without keys
    playerSetup.type = 'hls';
  }

  jwplayer("jwplayerDiv").setup(playerSetup);
}

// Fetch channels data and set up the player
fetchChannels(function (channels) {
  // Get channel ID from the URL
  var channelId = getParameterByName('id');
  // Find the channel data in the JSON
  var channelData = channels.find(channel => channel.id === channelId);

  if (channelData) {
    // Set up the player with the channel data
    setupPlayer(channelData);
  } else {
    console.error('Channel not found for ID:', channelId);
  }

}).on('ready', function() {
    // Set poster image for video element to avoid black background for audio-only programs.
    var video = document.getElementById(this.id).getElementsByTagName('video')[0];
    if (video) video.setAttribute('poster', this.getConfig().image);
    });
</script>
</body>
</html>
